<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>geohash</title>
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.1.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.1.0/ol.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <style>
        .map {
            width: 1500px;
            height: 800px;
        }
    </style>
  </head>
  <body>
    <div id="map" class="map">
        <div id="popup"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var map = new ol.Map({
            layers: [new ol.layer.Tile({ source: new ol.source.OSM() })],
            view: new ol.View({
                center: [136.9858554714588, 35.16251587222979],
                zoom: 8,
                projection: 'EPSG:4326'
            }),
            target: 'map'
        });

        let element = document.getElementById('popup');

        let popup = new ol.Overlay({
            element: element,
            stopEvent: false,
        });
        map.addOverlay(popup);

        let popover;
        map.on('click', async function (event) {
            console.log(popover);
            if (popover) {
                popover.dispose();
                popover = undefined;
            }
            let coordinate = map.getCoordinateFromPixel(event.pixel);
            let request = await fetch('/api/geohash', {
                method: 'post',
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({'coordinate': coordinate})
            });

            let geohash = await request.json();
            popover = new bootstrap.Popover(element, {
                container: element.parentElement,
                content: `geohash here : ${geohash.geohash}`,
                html: true,
                offset: [0, 20],
                placement: 'top',
                sanitize: false,
            });
            popover.show();
        })
    </script>
  </body>
</html>